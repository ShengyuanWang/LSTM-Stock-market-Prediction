---
title: "MCM_2022"
author: "MCM2022"
date: "2/17/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(keras)
library(caret)

install_keras()

theme_set(theme_minimal())

set.seed(123)
```

```{r}
# Load the data & clean the data
bitcoin_data <- read.csv("data/BCHAIN-MKPRU.csv") %>% 
  mutate(Date = as.Date(Date, "%m/%d/%y")) %>% 
  na.omit()

gold_data <- read.csv("data/LBMA-GOLD.csv") %>% 
  mutate(Date = as.Date(Date, "%m/%d/%y")) %>% 
  na.omit()
```

```{r}
# Visualize data
bitcoin_data %>% 
  ggplot(aes(x = Date,
             y = Value)) +
  geom_line()

gold_data %>% 
  ggplot(aes(x = Date,
             y = USD..PM.)) +
  geom_line()
```

```{r}
max_len <- 7
batch_size <- 32
total_epochs <- 15

bitcoin_price <- bitcoin_data$Value
```

```{r}
start_indexes <- seq(1, length(bitcoin_price) - (max_len + 1), by = 3)

bitcoin_matrix <- matrix(nrow = length(start_indexes), ncol = max_len + 1)

for (i in 1:length(start_indexes)) {
  bitcoin_matrix[i,] <- bitcoin_price[start_indexes[i]:(start_indexes[i] + max_len)]
}
```

```{r}
# make sure it's numeric
bitcoin_matrix <- bitcoin_matrix * 1

# remove na's if you have them
if(anyNA(bitcoin_matrix)){
    bitcoin_matrix <- na.omit(bitcoin_matrix)
}
```

```{r}
x <- bitcoin_matrix[,-ncol(bitcoin_matrix)]
y <- bitcoin_matrix[,ncol(bitcoin_matrix)]
```

```{r}
training_index <- createDataPartition(y, p = 0.9,
                                      list = FALSE,
                                      times = 1)
x_train <- array(x[training_index,], dim = c(length(training_index), max_len, 1))
y_train <- y[training_index]

x_test <- array(x[-training_index,], dim = c(length(training_index), max_len, 1))
y_test <- y[-training_index]
```

```{r}
model <- keras_model_sequential()
```

```{r}
dim(x_train)
```

```{r}
# Input layer
model %>% 
  layer_dense(input_shape = dim(x_train)[2:3], units = max_len)

# Number of N = 6
model %>% 
    layer_simple_rnn(units = 6)

# Output
model %>%
    layer_dense(units = 1, activation = 'relu')

# Glimpse the model
summary(model)
```

```{r}
# Metrics
model %>% compile(loss = 'mean_squared_error', 
                  optimizer = 'adam')
```

```{r}
# Training the model
trained_model <- model %>% fit(
    x = x_train, # sequence we're using for prediction 
    y = y_train, # sequence we're predicting
    batch_size = batch_size, # how many samples to pass to our model at a time
    epochs = total_epochs, # how many times we'll look @ the whole dataset
    validation_split = 0.1) # how much data to hold out for testing as we go along
```

```{r}
trained_model
```

```{r}
plot(trained_model)
```







